{% extends "layouts/main.html" %}
{% block content %}
<div class="container my-4">

<ul class="list-group list-group-horizontal d-flex justify-content-end mb-3">
{% if perms.auser.change_college %}
<li class="list-group-item list-group-item-primary"><a class="nav-link p-0" href="{% url 'auser:update_college' college.short_name %}"><i class="fa-solid fa-pen me-3"></i>Update </a></li>{% endif %}{% if perms.auser.can_add_college_representative and college.is_active %}
<li class="list-group-item list-group-item-primary"><a class="nav-link p-0" href="{% url 'auser:add_college_representative' college.short_name %}"><i class="fa-solid fa-user-plus me-3"></i>Add Dean</a></li>
<li class="list-group-item list-group-item-primary"><a class="nav-link p-0" href="#"><i class="fa-solid fa-circle-plus me-3"></i>Select Dean</a></li>
{% endif %}{% if perms.auser.can_change_status %}{% if college.is_active %}
<li class="list-group-item list-group-item-primary"><a class="nav-link text-danger p-0"  href="#" data-bs-toggle="modal" data-bs-target="#change-status-{{ college.short_name }}"><i class="fa-solid fa-toggle-off me-3"></i>Deactivate</a></li>{% else %}
<li class="list-group-item list-group-item-primary"><a class="nav-link text-success p-0"  href="#" data-bs-toggle="modal" data-bs-target="#change-status-{{ college.short_name }}"><i class="fa-solid fa-toggle-on me-3"></i>Activate</a></li>
{% endif %}{% endif %}{% if perms.auser.delete_college %}
<li class="list-group-item list-group-item-primary"><a class="nav-link text-danger fw-bolder p-0"  href="#" data-bs-toggle="modal" data-bs-target="#delete-college-{{ college.short_name }}"><i class="fa-solid fa-trash-can me-3"></i>Delete</a></li>
{% endif %}
</ul>
<h3 class="my-4"><span class="badge bg-{% if college.is_active %}success{% else %}danger{% endif %} rounded-pill me-2 fs-6">{{ college.get_status_display }}</span>{{ college.name }} ({{ college.short_name }})</h3>
<p class="lh-lg" style="text-align: justify;">{{ college.description|linebreaks }}</p>
<table class="table table-striped table-responsive mb-5 w-100">
	<thead>
		<td>Name</td>
		<td>Short Name</td>
		<td>Staff Members</td>
		<td>Department Heads</td>
		<td>Store Officers</td>
		<td>Lab Assistants</td>
		<td>Stores</td>
		<td>Labs</td>
	</thead>
	<caption class="text-center">
		Departments of {{ college.name }}
	</caption>
	<tbody>
	{% for department in college.departments.iterator %}{% with store_count=department.stores.count staff_count=department.users.count representatives_count=department.representatives.count officers_count=department.staff_members.count %}<tr>
			<td>{{ department.name  }}</td>
			<td>{{ department.short_name  }}</td>
			<td>{{ staff_count }}</td>
			<td>{{ representatives_count }}</td>
			<td>{{ officers_count }}</td>
			<td>TBD</td>
			<td>{{ store_count }}</td>
			<td>TBD</td>
		</tr>{% endwith %}{% endfor %}
	</tbody>
</table>
<table class="table table-striped table-responsive  w-100">
	<thead>
		<th class="border-bottom border-0">First name</th>
        <th class="border-bottom border-0">Last name</th>
        <th class="border-bottom border-0">Username</th>
        <th class="border-bottom border-0">Email</th>
        <th class="border-bottom border-0">Phone number</th>
        <th class="border-bottom border-0">Sex</th>
        <th class="border-bottom border-0">Status</th>
        <th class="border-bottom border-0 text-center">Department</th>
	</thead>
	<caption class="text-center">
		Deans of {{ college.name }}
	</caption>
	<tbody>{% if college.representatives %}{% for college_dean in college.representatives.iterator %}{% with college_dean=college_dean %}
        <tr>
            <td>{{ college_dean.first_name|default:"-" }}</td>
            <td>{{ college_dean.last_name|default:"-" }}</td>
            <td>{{ college_dean.username }}</td>
            <td>{{ college_dean.email }}</td>
            <td>{{ college_dean.phone_number }}</td>
            <td>{{ college_dean.get_sex_display }}</td>
            <td><span class="badge bg-{% if college_dean.is_active %}success{% else %}danger{% endif %} w-100">{% if college_dean.is_active %}Active{% else %}Deactivated{% endif %}</span></td>
            <td class="text-center">{{ college_dean.department.short_name|default:"-" }}</td>
        </tr>{% endwith %}{% empty %} He{% endfor %}{% endif %}
	</tbody>
</table>
{% if perms.auser.delete_college %}<div class="modal fade" id="delete-college-{{ college.short_name }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <span class="text-danger fw-bolder"><i class="fa-solid fa-triangle-exclamation me-2"></i> This action is irreversable.</span>
      </div>
      <div class="modal-body">
       Do you really wants to delete <strong>{{ college.name }}</strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-outline-secondary shadow-none" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark me-2"></i>Cancel</button>
        <form action="{% url 'auser:delete_college' college.short_name %}" method="post">{% csrf_token %}
           <button class="btn btn-outline-danger btn-sm shadow-none" type="submit"><i class="fa-solid fa-trash-can me-2"></i>I understand, delete!</button>
        </form>
      </div>
    </div>
  </div>
</div>{% endif %}{% if perms.auser.can_change_college %}<div class="modal fade" id="change-status-{{ college.short_name }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
       Do you really wants to {% if college.is_active %}deactivate{% else %}activate{% endif %} <strong>{{ college.name }}</strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-outline-secondary shadow-none" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark me-2"></i>Cancel</button>
        <form action="{% if college.is_active %}{% url 'auser:deactivate_college' college.short_name %}{% else %}{% url 'auser:activate_college' college.short_name %}{% endif %}" method="post">{% csrf_token %}
           <button class="btn btn-outline-{% if college.is_active %}warning{% else %}success{% endif %} btn-sm shadow-none" type="submit"><i class="fa-solid fa-check-circle me-2"></i>Confirm</button>
        </form>
      </div>
    </div>
  </div>
</div>{% endif %}
</div>
{% endblock content %}